// Generated by CoffeeScript 1.6.2
var mesureWidth, signiture;

mesureWidth = function(str, style) {
  var element, width;

  element = $("<div style=\"position: absolute; " + style + "\">" + str + "</div>");
  element.appendTo(document.body);
  width = element.width();
  element.remove();
  return width;
};

signiture = function(_arg) {
  var email, emailWidth, height, infoWidth, line1Width, line2Width, line3Width, line4Width, lineHeight, logoSpacer, metamarketsWidth, mmx, name, nameWidth, phone1, phone1Width, phone2, phone2Width, phoneTagWidth, position, positionWidth, signitureStr, spacerExtra, spacerWidth, table, tableAndRow, td, tdSpecer, tr;

  name = _arg.name, position = _arg.position, phone1 = _arg.phone1, phone2 = _arg.phone2, email = _arg.email;
  if (!/^[\w' -]+$/.test(name)) {
    return "Invalid name";
  }
  height = 52;
  logoSpacer = 6;
  lineHeight = 13;
  phoneTagWidth = 13;
  spacerWidth = 3;
  spacerExtra = 5;
  mmx = 'METAMARKETS';
  nameWidth = mesureWidth(name, 'font-size:11px; font-weight:bold;   font-family:Helvetica,Arial,Sans-Serif') + 5;
  positionWidth = mesureWidth(position, 'font-size:11px; font-weight:normal; font-family:Helvetica,Arial,Sans-Serif');
  metamarketsWidth = mesureWidth(mmx, 'font-size:11px; font-weight:normal; font-family:Helvetica,Arial,Sans-Serif');
  phone1Width = mesureWidth(phone1, 'font-size:11px; font-weight:normal; font-family:Helvetica,Arial,Sans-Serif') + 2;
  phone2Width = mesureWidth(phone2, 'font-size:11px; font-weight:normal; font-family:Helvetica,Arial,Sans-Serif') + 2;
  emailWidth = mesureWidth(email, 'font-size:11px; font-weight:normal; font-family:Helvetica,Arial,Sans-Serif') + 5;
  line1Width = nameWidth;
  line2Width = positionWidth + spacerExtra + spacerWidth + spacerExtra + metamarketsWidth;
  line3Width = phoneTagWidth + phone1Width + spacerExtra + spacerWidth + spacerExtra + phoneTagWidth + phone2Width;
  line4Width = emailWidth;
  infoWidth = Math.max(line1Width, line2Width, line3Width, line4Width);
  table = function(_arg1) {
    var height, html, style, width;

    width = _arg1.width, height = _arg1.height, html = _arg1.html, style = _arg1.style;
    style || (style = '');
    return "<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"border-collapse:collapse;" + style + "\">" + (html.trim()) + "</table>";
  };
  tr = function(_arg1) {
    var height, html;

    height = _arg1.height, html = _arg1.html;
    return "<tr height=" + height + ">" + (html.trim()) + "</tr>";
  };
  td = function(_arg1) {
    var html, style, width;

    width = _arg1.width, html = _arg1.html, style = _arg1.style;
    style || (style = '');
    return "<td width=" + width + "; style=\"padding:0;" + style + "\">" + (html.trim()) + "</td>";
  };
  tableAndRow = function(_arg1) {
    var height, html, style, width;

    width = _arg1.width, height = _arg1.height, html = _arg1.html, style = _arg1.style;
    return table({
      width: width,
      height: height,
      html: tr({
        height: height,
        html: html
      }),
      style: style
    });
  };
  tdSpecer = td({
    width: spacerWidth + spacerExtra,
    html: '|',
    style: 'color:#F95F39;'
  });
  signitureStr = "<br/><br/>" + tableAndRow({
    width: height + logoSpacer + infoWidth,
    height: height,
    html: td({
      width: height,
      html: "<a href=\"http://www.metamarkets.com\" target=\"_blank\">" + (logo(height)) + "</a>"
    }) + td({
      width: logoSpacer,
      html: ''
    }) + td({
      width: infoWidth,
      html: tableAndRow({
        width: line1Width,
        height: lineHeight,
        style: 'font-weight:bold;font-size:11px;font-family:Helvetica,Arial,Sans-Serif;white-space:nowrap',
        html: td({
          width: nameWidth,
          html: name,
          style: 'color:#333333;font-weight:bold;'
        })
      }) + tableAndRow({
        width: line2Width,
        height: lineHeight,
        style: 'font-size:11px;font-family:Helvetica,Arial,Sans-Serif;white-space:nowrap',
        html: td({
          width: positionWidth + spacerExtra,
          html: position,
          style: 'color:#666666;'
        }) + tdSpecer + td({
          width: metamarketsWidth,
          html: "<a style=\"color:#999999; text-decoration:none\" href=\"http://www.metamarkets.com\">" + mmx + "</a>"
        })
      }) + tableAndRow({
        width: line3Width,
        height: lineHeight,
        style: 'font-size:11px;font-family:Helvetica,Arial,Sans-Serif;white-space:nowrap',
        html: td({
          width: phoneTagWidth,
          html: 'm',
          style: 'color:#000000;font-weight:bold;'
        }) + td({
          width: phone1Width + spacerExtra,
          html: "<a style=\"color:#3e2105; text-decoration:none\" href=\"tel:" + phone1 + "\">" + phone1 + "</a>"
        }) + tdSpecer + td({
          width: phoneTagWidth,
          html: 'o',
          style: 'color:#000000;font-weight:bold;'
        }) + td({
          width: phone2Width + spacerExtra,
          html: "<a style=\"color:#3e2105; text-decoration:none\" href=\"tel:" + phone2 + "\">" + phone2 + "</a>"
        })
      }) + tableAndRow({
        width: line4Width,
        height: lineHeight,
        style: 'font-size:11px;font-family:Helvetica,Arial,Sans-Serif;white-space:nowrap',
        html: td({
          width: emailWidth,
          html: "<a style=\"color:#1c7bc3; text-decoration:none;\" href=\"mailto:" + email + "\">" + email + "</a>"
        })
      })
    })
  });
  signitureStr = signitureStr.replace(/>\s+</g, '><');
  console.log(signitureStr.length);
  if (!(signitureStr.length < 10000)) {
    return "Too long";
  }
  return signitureStr;
};
